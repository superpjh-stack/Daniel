# Plan: 출석 관리 월간 달력 전환

## 개요

현재 주간(7일) 뷰 형태의 출석 달력을 **월간 달력** 뷰로 전환합니다.
교사가 한 달 전체의 출석 현황을 한눈에 파악하고, 날짜를 클릭하여 해당 일의 출석을 관리할 수 있도록 합니다.

## 현재 상태 (AS-IS)

- `startOfWeek` + 7일 배열로 일주일 단위 달력 표시
- `ChevronLeft/Right`로 ±7일 이동
- 날짜 클릭 시 해당 일의 출석 데이터 로드
- 미래 날짜 비활성화
- 오늘 날짜 하이라이트
- 일요일 빨간색 표시

## 변경 목표 (TO-BE)

### FR-01: 월간 달력 그리드
- 7열(일~토) x 최대 6행의 월간 달력 그리드 표시
- 요일 헤더(일, 월, 화, 수, 목, 금, 토) 고정
- 해당 월의 시작 요일에 맞춰 빈 칸 처리
- 이전/다음 달 날짜는 흐리게 표시하거나 빈 칸 처리

### FR-02: 월 단위 네비게이션
- `ChevronLeft/Right`로 이전/다음 달 이동
- 헤더에 "2026년 2월" 형식으로 현재 월 표시
- "오늘" 버튼으로 현재 월/오늘 날짜로 즉시 복귀

### FR-03: 날짜별 출석 상태 표시 (핵심 기능)
- 각 날짜 셀에 해당 일의 출석 요약을 시각적으로 표시
- 출석 완료일: 초록 점(dot) 또는 배경색
- 부분 출석일: 주황 점
- 미입력일: 표시 없음
- 선택된 날짜: 보라색 그라데이션 하이라이트 (현행 유지)
- 오늘: 보라색 테두리 또는 밝은 배경 (현행 유지)

### FR-04: 날짜 클릭 동작
- 날짜 클릭 시 해당 일의 출석 학생 목록 로드 (현행 로직 유지)
- 미래 날짜 비활성화 (현행 유지)
- 일요일 날짜 빨간색 (현행 유지)

### FR-05: 월간 출석 데이터 API
- 월 단위로 출석 요약 데이터를 가져오는 API 추가
- `GET /api/attendance/monthly?year=2026&month=2&classId=all`
- 응답: `{ [date: string]: { total, present, late, absent } }`
- 달력의 각 날짜 셀에 표시할 요약 데이터 제공

### FR-06: 모바일 최적화
- 모바일에서 달력 셀 크기를 컴팩트하게 유지
- 날짜 숫자 + 상태 점(dot)만 표시 (모바일)
- 데스크톱에서는 출석/결석 수치도 표시 가능

## 기술적 변경 사항

### 변경 파일

1. **`src/app/(dashboard)/attendance/page.tsx`** (주요 변경)
   - `startOfWeek` + 7일 → `startOfMonth` + `endOfMonth` + `getDaysInMonth` 등으로 교체
   - 주간 네비게이션(±7일) → 월간 네비게이션(±1개월)
   - 7칸 그리드 → 7열 x 최대 6행 월간 그리드
   - 월간 출석 요약 데이터 fetch 추가

2. **`src/app/api/attendance/monthly/route.ts`** (신규)
   - 월 단위 출석 요약 API
   - 해당 월의 모든 날짜별 출석/지각/결석 카운트 반환

3. **`src/lib/db.ts`** (함수 추가)
   - `getMonthlyAttendanceSummary(year, month, classId?)` 함수 추가

## 변경하지 않는 것

- 출석 저장 로직 (POST /api/attendance) - 그대로 유지
- 학생 목록 표시 및 상태 변경 UI - 그대로 유지
- 달란트 자동 지급/차감 로직 - 그대로 유지
- 일괄 처리(전체 출석/전체 결석) - 그대로 유지
- 이력 모달, 확인 다이얼로그, 연속 출석 보너스 - 그대로 유지
- 검색/필터 기능 - 그대로 유지
- 미저장 변경 경고 - 그대로 유지

## 구현 순서

1. DB 함수 추가 (`getMonthlyAttendanceSummary`)
2. 월간 요약 API 엔드포인트 생성
3. 프론트엔드 달력 UI를 주간→월간으로 교체
4. 날짜 셀에 출석 상태 점(dot) 표시
5. 테스트 및 모바일 확인

## 예상 영향

- **사용자 경험**: 한 달 전체 출석 현황을 한눈에 파악 가능
- **기존 기능**: 저장/로드/달란트 등 핵심 로직 변경 없음
- **성능**: 월간 요약 API 1회 추가 호출 (달력 렌더링 시)
