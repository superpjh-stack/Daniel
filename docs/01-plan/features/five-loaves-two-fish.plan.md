# Five Loaves & Two Fish Plan

> **Feature**: five-loaves-two-fish
> **Date**: 2026-02-17
> **Status**: Draft
> **Priority**: Medium

---

## 1. Overview

### 1.1 Background
동은교회 초등부 게임 메뉴에 4번째 게임을 추가합니다. 기존 벽돌깨기(성경퀴즈), 노아의 방주(테트리스), 다윗의 물맷돌(슈팅)에 이어, 요한복음 6장의 오병이어 기적을 기반으로 한 타이쿤(서빙) 게임을 제공합니다. 몰려오는 군중에게 빵과 물고기를 끊임없이 나누어 주며, 나눌수록 오히려 늘어나는 기적을 체험합니다.

### 1.2 Goal
플레이어가 바구니의 음식(빵 5개, 물고기 2마리)을 군중에게 클릭/터치로 빠르게 전달하는 고속 서빙 게임을 구현합니다. 제자 캐릭터를 업그레이드하여 서빙 속도를 높이고, 나누어 줄수록 음식이 줄지 않고 점수가 올라가는 "기적 효과"를 시각적으로 표현합니다.

### 1.3 Target Users
- **학생**: 게임 플레이 및 달란트 보상 획득
- **교사/관리자**: 학생에게 달란트 보상 지급

---

## 2. Requirements

### 2.1 Functional Requirements

#### FR-01: 핵심 게임 메커니즘 (음식 서빙)
- 화면 하단에 바구니가 있고, 빵과 물고기가 담겨 있음
- 화면 중앙~상단에 군중이 줄을 지어 다가옴 (좌→우, 우→좌 다방향)
- 군중 위에 말풍선으로 원하는 음식 표시 (빵 🍞 또는 물고기 🐟)
- 바구니의 음식을 클릭/터치하여 해당 군중에게 전달
- 올바른 음식을 전달하면 점수 획득, 틀리면 감점 없이 미스 처리
- 군중이 기다리다 떠나면(타임아웃) 생명력 감소

#### FR-02: 기적 효과 시각화
- 음식을 나눠줄 때마다 바구니의 음식이 줄어들지 않음
- 대신 바구니에서 빛나는 이펙트 + 음식이 증식하는 애니메이션
- 나눠준 총 개수 카운터: "나눈 빵: 127개 / 나눈 물고기: 89개"
- 기적 게이지: 연속 서빙 성공 시 게이지 상승 → 풀 충전 시 "기적 타임" 발동
- 기적 타임: 5초간 자동 서빙 + 점수 2배 + 화면에 빛 이펙트

#### FR-03: 제자 업그레이드 시스템
- 12제자 중 5명을 업그레이드 가능 (베드로, 안드레, 야고보, 요한, 빌립)
- 스테이지 클리어 시 획득하는 "업그레이드 포인트"로 구매
- 업그레이드 효과:
  - 베드로: 서빙 범위 증가 (클릭 판정 넓어짐)
  - 안드레: 군중 타임아웃 시간 +2초
  - 야고보: 기적 게이지 충전 속도 20% 증가
  - 요한: 기적 타임 지속시간 +2초
  - 빌립: 자동 서빙 (3초에 1번 자동으로 올바른 음식 전달)
- 각 제자는 3단계까지 업그레이드 가능 (비용 증가)

#### FR-04: 스테이지 시스템 (5단계)
- 스테이지 1: 군중 느리게 등장, 빵만 요청 (튜토리얼)
- 스테이지 2: 물고기 추가, 속도 약간 증가
- 스테이지 3: 군중 2줄, 속도 증가, 특별 군중(아이) 등장 (보너스 점수)
- 스테이지 4: 군중 3줄, 복합 요청 (빵+물고기 동시), 속도 증가
- 스테이지 5: 최종 - 5000명 목표, 모든 패턴 등장, 최고 속도
- 각 스테이지별 목표 인원수 달성 시 클리어

#### FR-05: 성경 말씀 & 퀴즈
- 각 스테이지 클리어 시 오병이어 관련 성경 말씀 표시
- 스테이지 3, 5 클리어 시 퀴즈 1문제 (오병이어/예수님의 기적 관련)
- 퀴즈 정답 시 보너스 업그레이드 포인트 + 생명력 회복

#### FR-06: 달란트 보상
- 기존 게임과 동일한 보상 API 패턴 (`/api/games/five-loaves/reward`)
- 스테이지 1 클리어: +1 달란트
- 스테이지 3 클리어: +2 추가
- 스테이지 5 클리어: +2 추가 (전체 최대 5)
- 퀴즈 전부 정답: +2 보너스
- 하루 3회 제한
- 교사/관리자만 보상 지급 가능

#### FR-07: 게임 UI/UX
- Canvas 기반 렌더링 (기존 게임 패턴 동일)
- 모바일 세로 화면 최적화 (max-width: 400px)
- 게임 시작 전 학생 선택 (보상용)
- 바구니, 군중, 점수, 생명력, 기적 게이지, 스테이지 표시
- 스테이지 클리어 모달 (업그레이드 선택 포함), 게임오버 모달
- 효과음: 서빙 성공, 미스, 기적 타임, 스테이지 클리어 등

---

## 3. Game Design

### 3.1 화면 레이아웃

```
┌──────────────────────────────────┐
│  ❤️❤️❤️   Score: 2400   Stage 3/5 │
│  나눈 빵: 127 / 물고기: 89       │
│  기적: [████████░░] 80%          │
│                                  │
│  → 😊🍞  😊🐟  😊🍞  →        │ ← 군중 줄 1
│  ← 😊🐟  👧🍞  😊🍞  ←        │ ← 군중 줄 2
│                                  │
│  ┌──────────────────────┐        │
│  │ 제자: 베드로 Lv.2    │        │
│  │       안드레 Lv.1    │        │
│  └──────────────────────┘        │
│                                  │
│         ┌──────────┐             │
│         │ 🍞🐟🍞  │  ← 바구니  │
│         │  🐟🍞   │   (기적✨)  │
│         └──────────┘             │
│  [🍞 빵 서빙]  [🐟 물고기 서빙] │
└──────────────────────────────────┘
```

### 3.2 서빙 메커니즘

```
1. 군중이 말풍선으로 원하는 음식 표시
2. 플레이어가 해당 군중을 터치/클릭
3. 바구니에서 음식이 날아가는 애니메이션
4. 군중이 받으면 점수 획득 + 기적 이펙트
5. 연속 성공 → 기적 게이지 상승
6. 군중이 타임아웃 → 실망하며 떠남 → HP 감소
```

### 3.3 기적 시각 효과

```
- 바구니: 황금빛 파티클, 음식 증식 애니메이션
- 서빙 성공: 군중 위에 ✨ + 점수 플로팅
- 기적 타임: 화면 전체 황금빛 오버레이, 자동 서빙 라인
- 5000명 달성: "남은 12바구니" 텍스트 + 대형 이펙트
```

---

## 4. Technical Considerations

### 4.1 파일 구조 (기존 패턴)
```
src/app/(dashboard)/games/five-loaves/
  ├── page.tsx                       # 서버 컴포넌트 (학생 로드)
  ├── _lib/
  │   ├── types.ts                   # 타입 정의
  │   ├── stages.ts                  # 스테이지/난이도 설정
  │   ├── quizData.ts                # 퀴즈 데이터
  │   ├── gameEngine.ts              # 게임 로직 (서빙, 군중, 업그레이드)
  │   └── renderer.ts                # Canvas 렌더링 (기적 이펙트 포함)
  ├── _components/
  │   ├── FiveLoavesWrapper.tsx      # 클라이언트 래퍼
  │   ├── FiveLoavesGame.tsx         # 메인 게임 컴포넌트
  │   ├── QuizModal.tsx              # 퀴즈 모달
  │   ├── StageClearModal.tsx        # 스테이지 클리어 + 업그레이드 모달
  │   └── GameOverModal.tsx          # 게임오버 모달

src/app/api/games/five-loaves/
  └── reward/route.ts                # 달란트 보상 API
```

### 4.2 Canvas 렌더링
- requestAnimationFrame 기반 60fps 게임 루프
- 군중 스프라이트: 이모지 기반 렌더링 (기존 패턴)
- 기적 이펙트: 파티클 시스템 (황금빛 원형 파티클)
- 음식 날아가는 애니메이션: 베지어 곡선 경로

### 4.3 모바일 최적화
- 터치 타겟: 군중 클릭 영역 최소 44px
- 하단 서빙 버튼: 빵/물고기 2개 버튼으로 간편 서빙 (모바일)
- 세로 화면 고정 (400 x 600px 기준)

### 4.4 보상 API
- 기존 다윗의 물맷돌 reward API 패턴 동일
- 교사/관리자 인증, 학생 확인, 일일 제한(3회), 트랜잭션

### 4.5 효과음 (soundEngine 확장)
- 서빙 성공: 짧은 "딩" 효과
- 미스/타임아웃: 실망 효과
- 기적 타임 발동: 신비로운 상승음
- 업그레이드 구매: 레벨업 효과
- 기존 공통 사운드 (퀴즈, 스테이지 클리어, 게임오버) 재사용

---

## 5. Implementation Order

1. 타입 정의 + 스테이지 설정 + 퀴즈 데이터
2. 게임 엔진 (군중 생성/이동, 서빙 로직, 업그레이드 시스템, 기적 게이지)
3. Canvas 렌더러 (군중, 바구니, 기적 이펙트, 파티클)
4. 메인 게임 컴포넌트 (FiveLoavesGame)
5. 모달 컴포넌트 (Quiz, StageClear + 업그레이드, GameOver)
6. 래퍼 + 서버 페이지 (page.tsx)
7. 보상 API
8. 효과음 추가 (soundEngine 확장)
9. 게임 목록 페이지 업데이트 (games/page.tsx)

---

## 6. Out of Scope

- 멀티플레이어
- 커스텀 캐릭터/스킨
- 랭킹 시스템 (향후 추가 가능)
- 12제자 전체 (5명만 구현)
- 가로 모드 지원

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 0.1 | 2026-02-17 | Initial draft | AI Assistant |
