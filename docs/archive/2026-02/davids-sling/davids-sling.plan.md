# David's Sling Plan

> **Feature**: davids-sling
> **Date**: 2026-02-16
> **Status**: Draft
> **Priority**: Medium

---

## 1. Overview

### 1.1 Background
동은교회 초등부 게임 메뉴에 3번째 게임을 추가합니다. 기존 벽돌깨기(성경퀴즈)와 노아의 방주(테트리스)에 이어, 다윗과 골리앗 이야기를 기반으로 한 액션 슈팅 게임을 제공하여 아이들이 성경 이야기를 체험할 수 있게 합니다.

### 1.2 Goal
플레이어(다윗)가 골리앗이 던지는 장애물을 피하면서, 마우스/터치 드래그로 물맷돌을 날려 골리앗의 약점을 맞히는 액션 슈팅 게임을 구현합니다. 믿음 게이지 시스템으로 성경적 메시지를 자연스럽게 전달합니다.

### 1.3 Target Users
- **학생**: 게임 플레이 및 달란트 보상 획득
- **교사/관리자**: 학생에게 달란트 보상 지급

---

## 2. Requirements

### 2.1 Functional Requirements

#### FR-01: 플레이어 조작 (다윗)
- 화면 하단에서 좌/우로 이동 (키보드 좌우 또는 터치 드래그)
- 골리앗이 던지는 장애물(돌, 창)을 피해야 함
- 장애물에 맞으면 생명력(HP 3칸) 감소

#### FR-02: 물맷돌 발사 (슬링 메커니즘)
- 마우스/터치 드래그로 발사 방향과 세기를 조절
- 다윗 위치에서 드래그 시작 → 반대 방향으로 물맷돌 발사 (새총 방식)
- 드래그 중 궤적 가이드라인 표시
- 발사 쿨다운: 1초

#### FR-03: 골리앗 (보스)
- 화면 상단에 거대한 골리앗 표시
- 약점 부위 3개소: 이마(치명타), 왼팔, 오른팔
- 약점은 주기적으로 열리고 닫힘 (빛나는 표시)
- 약점에 맞으면 데미지, 다른 부위는 튕겨남
- HP 바 표시, 스테이지별 HP 증가

#### FR-04: 골리앗 공격 패턴
- 패턴 1: 직선 돌 던지기 (느림, 예측 가능)
- 패턴 2: 부채꼴 창 던지기 (3방향)
- 패턴 3: 추적 돌 (플레이어를 따라옴, 느림)
- 스테이지가 올라가면 패턴 조합, 속도 증가

#### FR-05: 믿음 게이지
- 장애물을 피할 때마다 게이지 소량 증가
- 기도 아이템(하늘에서 떨어지는 빛) 획득 시 대량 증가
- 풀 게이지(100%) 달성 시 "정확한 조준" 모드 활성화:
  - 3초간 슬로우 모션
  - 골리앗 약점 항상 열림
  - 조준선이 더 정확하게 표시
- 사용 후 게이지 리셋

#### FR-06: 스테이지 시스템 (5단계)
- 스테이지 1: 기본 (직선 돌만, 느림)
- 스테이지 2: 창 등장, 속도 약간 증가
- 스테이지 3: 추적 돌 등장
- 스테이지 4: 복합 패턴
- 스테이지 5: 최종 (모든 패턴, 빠름)
- 골리앗 HP 소진 시 스테이지 클리어 → 성경 말씀 표시 + 다음 스테이지

#### FR-07: 성경 말씀 & 퀴즈
- 각 스테이지 클리어 시 다윗과 골리앗 관련 성경 말씀 표시
- 스테이지 3, 5 클리어 시 퀴즈 1문제 (다윗/골리앗 관련)
- 퀴즈 정답 시 생명력 회복 + 보너스 점수

#### FR-08: 달란트 보상
- 기존 게임과 동일한 보상 API 패턴 (`/api/games/davids-sling/reward`)
- 스테이지 1 클리어: +1 달란트
- 스테이지 3 클리어: +2 추가
- 스테이지 5 클리어: +2 추가 (전체 최대 5)
- 퀴즈 전부 정답: +2 보너스
- 하루 3회 제한
- 교사/관리자만 보상 지급 가능

#### FR-09: 게임 UI/UX
- Canvas 기반 렌더링 (기존 게임 패턴 동일)
- 모바일 세로 화면 최적화 (max-width: 400px)
- 게임 시작 전 학생 선택 (보상용)
- HP 바, 믿음 게이지 바, 점수 표시
- 스테이지 클리어 모달, 게임오버 모달

---

## 3. Game Design

### 3.1 화면 레이아웃

```
┌──────────────────────────────────┐
│  HP: ❤️❤️❤️    Score: 1200       │
│  믿음: [████████░░] 80%          │
│  Stage 3/5                       │
│                                  │
│         ┌──────────┐             │
│         │  골리앗   │  ← HP 바   │
│         │  (약점)   │             │
│         └──────────┘             │
│                                  │
│       🪨      🪨                 │ ← 장애물
│          🪨                      │
│    ✨ (기도아이템)                │
│                                  │
│                                  │
│                                  │
│          ●←─── 궤적              │
│         다윗                     │
│  [드래그하여 물맷돌 발사!]       │
└──────────────────────────────────┘
```

### 3.2 물맷돌 발사 메커니즘

```
1. 다윗 위치에서 터치/마우스다운
2. 반대 방향으로 드래그 (새총 잡아당기기)
3. 드래그 중: 예상 궤적 점선 표시
4. 놓으면(터치/마우스업): 물맷돌 발사
5. 발사 후 1초 쿨다운
```

---

## 4. Technical Considerations

### 4.1 파일 구조 (기존 패턴)
```
src/app/(dashboard)/games/davids-sling/
  ├── page.tsx                    # 서버 컴포넌트 (학생 로드)
  ├── _lib/
  │   ├── types.ts               # 타입 정의
  │   ├── stages.ts              # 스테이지/난이도 설정
  │   ├── quizData.ts            # 퀴즈 데이터
  │   ├── gameEngine.ts          # 게임 로직 (충돌, 이동)
  │   └── renderer.ts            # Canvas 렌더링
  ├── _components/
  │   ├── DavidsSlingWrapper.tsx  # 클라이언트 래퍼
  │   ├── DavidsSlingGame.tsx     # 메인 게임 컴포넌트
  │   ├── QuizModal.tsx          # 퀴즈 모달
  │   ├── StageClearModal.tsx    # 스테이지 클리어 모달
  │   └── GameOverModal.tsx      # 게임오버 모달

src/app/api/games/davids-sling/
  └── reward/route.ts            # 달란트 보상 API
```

### 4.2 Canvas 렌더링
- requestAnimationFrame 기반 60fps 게임 루프
- 터치/마우스 이벤트로 드래그 발사 구현
- 충돌 감지: 원형(물맷돌/장애물) vs 사각형(골리앗 약점)

### 4.3 모바일 최적화
- 터치 드래그 → 물맷돌 발사
- 기기 좌/우 기울기 → 다윗 이동 (선택사항, 기본은 터치)
- 세로 화면 고정 (400 x 600px 기준)

### 4.4 보상 API
- 기존 노아의 방주 reward API 패턴 동일
- 교사/관리자 인증, 학생 확인, 일일 제한(3회), 트랜잭션

---

## 5. Implementation Order

1. 타입 정의 + 스테이지 설정 + 퀴즈 데이터
2. 게임 엔진 (이동, 충돌, 물맷돌 물리)
3. Canvas 렌더러
4. 메인 게임 컴포넌트 (DavidsSlingGame)
5. 모달 컴포넌트 (Quiz, StageClear, GameOver)
6. 래퍼 + 서버 페이지 (page.tsx)
7. 보상 API
8. 게임 목록 페이지 업데이트 (games/page.tsx)

---

## 6. Out of Scope

- 멀티플레이어
- 커스텀 캐릭터/스킨
- 랭킹 시스템 (향후 추가 가능)
- BGM/효과음 (브라우저 자동재생 제한)
- 골리앗 이외의 추가 보스

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 0.1 | 2026-02-16 | Initial draft | AI Assistant |
