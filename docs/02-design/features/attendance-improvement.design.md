# Attendance Improvement Design Document

> **Summary**: ì¶œì„ ì‹œìŠ¤í…œ ê°œì„  - ì¼ê´„ ì²˜ë¦¬, ë‹¬ë€íŠ¸ ì„¤ì •, ì¶œì„ ì´ë ¥, ì—°ì† ì¶œì„, UX ë³´í˜¸ ê¸°ëŠ¥ì˜ ê¸°ìˆ  ì„¤ê³„
>
> **Project**: daniel (ë™ì€êµíšŒ ì´ˆë“±ë¶€ ì¶œì„/ë‹¬ë€íŠ¸ ê´€ë¦¬)
> **Version**: 1.0.0
> **Author**: Claude Code
> **Date**: 2026-02-13
> **Status**: Draft
> **Planning Doc**: [attendance-improvement.plan.md](../../01-plan/features/attendance-improvement.plan.md)

---

## 1. Overview

### 1.1 Design Goals

- ê¸°ì¡´ ì½”ë“œ êµ¬ì¡°(db.ts ë‹¨ì¼ ë°ì´í„° ê³„ì¸µ, API Route, í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸)ë¥¼ ìœ ì§€í•˜ë©´ì„œ í™•ì¥
- Setting ëª¨ë¸ì„ í™œìš©í•œ ì¶œì„ ë‹¬ë€íŠ¸ ì„¤ì • ê°€ëŠ¥í™”
- better-sqlite3 íŠ¸ëœì­ì…˜ì„ í™œìš©í•œ ì¼ê´„ ì²˜ë¦¬ ì›ìì„± ë³´ì¥
- ëª¨ë°”ì¼ ìš°ì„  UX: ì¼ê´„ ë²„íŠ¼, í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸, ì´íƒˆ ë°©ì§€
- ì—°ì† ì¶œì„ ê³„ì‚°ì„ DB ì¿¼ë¦¬ë¡œ íš¨ìœ¨ì  ì²˜ë¦¬

### 1.2 Design Principles

- **ê¸°ì¡´ íŒ¨í„´ ìœ ì§€**: ìƒˆ DB ì—°ê²° â†’ ì¿¼ë¦¬ â†’ ì—°ê²° ë‹«ê¸° íŒ¨í„´ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
- **ìµœì†Œ ë³€ê²½**: ê¸°ì¡´ íŒŒì¼ì— ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë˜, êµ¬ì¡°ì  ë¦¬íŒ©í† ë§ì€ í•˜ì§€ ì•ŠìŒ
- **í•˜ìœ„ í˜¸í™˜ì„±**: ê¸°ì¡´ API ìš”ì²­/ì‘ë‹µ í˜•ì‹ ìœ ì§€, ìƒˆ í•„ë“œëŠ” ì„ íƒì ìœ¼ë¡œ ì¶”ê°€

---

## 2. Architecture

### 2.1 Component Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  attendance/page.tsx (Client Component)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Weekly   â”‚ â”‚ Bulk     â”‚ â”‚ Summary  â”‚ â”‚ Student Cards   â”‚  â”‚
â”‚  â”‚ Calendar â”‚ â”‚ Actions  â”‚ â”‚ Stats    â”‚ â”‚ + Streak Badge  â”‚  â”‚
â”‚  â”‚ (ê¸°ì¡´)   â”‚ â”‚ (ì‹ ê·œ)   â”‚ â”‚ (ì‹ ê·œ)   â”‚ â”‚ + History Modal â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Confirm Dialog    â”‚ â”‚ Unsaved Changes Guard             â”‚ â”‚
â”‚  â”‚ (ì‹ ê·œ)            â”‚ â”‚ (ì‹ ê·œ: beforeunload)              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ fetch()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  API Routes                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ /api/attendance       â”‚ â”‚ /api/attendance/history (ì‹ ê·œ) â”‚ â”‚
â”‚  â”‚  GET: ê¸°ì¡´ + streak   â”‚ â”‚  GET: í•™ìƒë³„ ì¶œì„ ì´ë ¥        â”‚ â”‚
â”‚  â”‚  POST: ì„¤ì •ê°’ ì°¸ì¡°    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚   + ì—°ì† ì¶œì„ ë³´ë„ˆìŠ¤  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   + ë‚ ì§œ ê²€ì¦         â”‚ â”‚ /api/settings (ì‹ ê·œ)           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  GET/PUT: ì„¤ì • CRUD             â”‚ â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  src/lib/db.ts (Data Access Layer)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ê¸°ì¡´ í•¨ìˆ˜:                                               â”‚ â”‚
â”‚  â”‚  getAttendanceByDate, upsertAttendance,                  â”‚ â”‚
â”‚  â”‚  updateStudentTalentBalance, createTalentRecord          â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ì‹ ê·œ í•¨ìˆ˜:                                               â”‚ â”‚
â”‚  â”‚  getSettingValue(key)                                    â”‚ â”‚
â”‚  â”‚  upsertSetting(key, value)                               â”‚ â”‚
â”‚  â”‚  getStudentAttendanceHistory(studentId, limit)           â”‚ â”‚
â”‚  â”‚  getStudentAttendanceStreak(studentId)                   â”‚ â”‚
â”‚  â”‚  getAttendanceSummaryByDate(date, classId?)              â”‚ â”‚
â”‚  â”‚  batchUpsertAttendance(date, records, talentPoints)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  prisma/dev.db (SQLite)  â”‚
â”‚  Setting í…Œì´ë¸” í™œìš©      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Data Flow

#### ì¼ê´„ ì¶œì„ ì²˜ë¦¬ Flow
```
êµì‚¬: "ì „ì²´ ì¶œì„" í´ë¦­
  â†’ ë¡œì»¬ stateì— ëª¨ë“  í•™ìƒ status='present' ë°˜ì˜
  â†’ "ì €ì¥" í´ë¦­
  â†’ POST /api/attendance (ê¸°ì¡´ í˜•ì‹)
  â†’ API: Settingì—ì„œ talent_points ì¡°íšŒ
  â†’ API: batchUpsertAttendance() (íŠ¸ëœì­ì…˜)
  â†’ ê° í•™ìƒ: upsert attendance + ë‹¬ë€íŠ¸ ì²˜ë¦¬
  â†’ ì—°ì† ì¶œì„ ì²´í¬ â†’ ë³´ë„ˆìŠ¤ ë‹¬ë€íŠ¸ ì§€ê¸‰
  â†’ ì‘ë‹µ: { success, streakBonuses: [...] }
```

#### ì¶œì„ ì´ë ¥ ì¡°íšŒ Flow
```
êµì‚¬: í•™ìƒ ì¹´ë“œ í´ë¦­
  â†’ GET /api/attendance/history?studentId={id}&limit=20
  â†’ DB: getStudentAttendanceHistory()
  â†’ ëª¨ë‹¬ì— ì´ë ¥ í‘œì‹œ
```

### 2.3 Dependencies

| Component | Depends On | Purpose |
|-----------|-----------|---------|
| attendance/page.tsx | /api/attendance, /api/attendance/history | ì¶œì„ ë°ì´í„° CRUD ë° ì´ë ¥ ì¡°íšŒ |
| /api/attendance POST | db.ts: batchUpsertAttendance, getSettingValue | ì¼ê´„ ì¶œì„ ì €ì¥ ë° ì„¤ì •ê°’ ì°¸ì¡° |
| /api/attendance/history | db.ts: getStudentAttendanceHistory | í•™ìƒë³„ ì´ë ¥ ì¡°íšŒ |
| /api/settings | db.ts: getSettingValue, upsertSetting | ì„¤ì • CRUD |
| settings/page.tsx | /api/settings | ì„¤ì • UI |

---

## 3. Data Model

### 3.1 Setting í…Œì´ë¸” í™œìš© (ê¸°ì¡´ ëª¨ë¸, ì‹ ê·œ ë°ì´í„°)

```
Setting í…Œì´ë¸” (ê¸°ì¡´ ìŠ¤í‚¤ë§ˆ, ë³€ê²½ ì—†ìŒ)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ id      â”‚ key                        â”‚ value  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ (cuid)  â”‚ attendance_talent_points   â”‚ "5"    â”‚
â”‚ (cuid)  â”‚ streak_bonus_threshold     â”‚ "4"    â”‚
â”‚ (cuid)  â”‚ streak_bonus_points        â”‚ "10"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì„¤ì • í‚¤ ì •ì˜:**

| Key | Default | Description |
|-----|---------|-------------|
| `attendance_talent_points` | `"5"` | ì¶œì„/ì§€ê° ì‹œ ì§€ê¸‰ë˜ëŠ” ê¸°ë³¸ ë‹¬ë€íŠ¸ |
| `streak_bonus_threshold` | `"4"` | ì—°ì† ì¶œì„ ë³´ë„ˆìŠ¤ ë°œìƒ ê¸°ì¤€ íšŸìˆ˜ |
| `streak_bonus_points` | `"10"` | ì—°ì† ì¶œì„ ë³´ë„ˆìŠ¤ ë‹¬ë€íŠ¸ |

### 3.2 Entity Relationships (ë³€ê²½ ì—†ìŒ)

```
[Student] 1 â”€â”€â”€â”€ N [Attendance]  (studentId+date UNIQUE)
    â”‚
    â””â”€â”€ 1 â”€â”€â”€â”€ N [Talent]        (type: attendance/bonus/purchase)

[Setting]  key-value ë…ë¦½ í…Œì´ë¸”
```

### 3.3 ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì—¬ë¶€

**Prisma ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì—†ìŒ** - ê¸°ì¡´ Setting ëª¨ë¸ë¡œ ì¶©ë¶„. ë§ˆì´ê·¸ë ˆì´ì…˜ ë¶ˆí•„ìš”.

---

## 4. API Specification

### 4.1 Endpoint List

| Method | Path | Description | Auth | Status |
|--------|------|-------------|------|--------|
| GET | `/api/attendance` | ë‚ ì§œë³„ í•™ìƒ ì¶œì„ ëª©ë¡ + ì—°ì†ì¶œì„ | Required | **ìˆ˜ì •** |
| POST | `/api/attendance` | ì¶œì„ ì¼ê´„ ì €ì¥ + ë‹¬ë€íŠ¸ ì²˜ë¦¬ | Required | **ìˆ˜ì •** |
| GET | `/api/attendance/history` | í•™ìƒë³„ ì¶œì„ ì´ë ¥ ì¡°íšŒ | Required | **ì‹ ê·œ** |
| GET | `/api/settings` | ì „ì²´ ì„¤ì • ì¡°íšŒ | Admin | **ì‹ ê·œ** |
| PUT | `/api/settings` | ì„¤ì • ì €ì¥ | Admin | **ì‹ ê·œ** |

### 4.2 Detailed Specification

---

#### `GET /api/attendance` (ìˆ˜ì •)

ê¸°ì¡´ ì‘ë‹µì— `streak` í•„ë“œ ì¶”ê°€.

**Request (ë³€ê²½ ì—†ìŒ):**
```
GET /api/attendance?date=2026-02-13&classId=all
```

**Response (ìˆ˜ì • - streak ì¶”ê°€):**
```json
{
  "students": [
    {
      "id": "clxxx",
      "name": "ê¹€ë¯¼ì¤€",
      "grade": 3,
      "className": "ë‹¤ìœ—ë°˜",
      "attendance": { "status": "present", "memo": "" },
      "streak": 4
    }
  ],
  "summary": {
    "total": 25,
    "present": 20,
    "late": 2,
    "absent": 3
  }
}
```

---

#### `POST /api/attendance` (ìˆ˜ì •)

ë‚ ì§œ ê²€ì¦ ì¶”ê°€, í•˜ë“œì½”ë”© ë‹¬ë€íŠ¸ â†’ Setting ì°¸ì¡°, ì—°ì†ì¶œì„ ë³´ë„ˆìŠ¤ ë¡œì§ ì¶”ê°€.

**Request (ë³€ê²½ ì—†ìŒ):**
```json
{
  "date": "2026-02-13",
  "attendance": {
    "student-id-1": { "status": "present", "memo": "" },
    "student-id-2": { "status": "absent", "memo": "ê°€ì¡±ì—¬í–‰" }
  }
}
```

**Response (ìˆ˜ì • - ë³´ë„ˆìŠ¤ ì •ë³´ ì¶”ê°€):**
```json
{
  "success": true,
  "streakBonuses": [
    { "studentId": "student-id-1", "studentName": "ê¹€ë¯¼ì¤€", "streak": 4, "bonus": 10 }
  ]
}
```

**Error Responses (ì‹ ê·œ):**
```json
// 400: ë¯¸ë˜ ë‚ ì§œ
{ "error": "ë¯¸ë˜ ë‚ ì§œì—ëŠ” ì¶œì„ì„ ê¸°ë¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤." }
```

**ë³€ê²½ ë¡œì§:**
1. ë‚ ì§œ ê²€ì¦: `date > today` â†’ 400 ì—ëŸ¬
2. Settingì—ì„œ `attendance_talent_points` ì¡°íšŒ (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ 5)
3. ê¸°ì¡´ ë‹¬ë€íŠ¸ ë¡œì§ì—ì„œ `ATTENDANCE_TALENT` ìƒìˆ˜ ëŒ€ì‹  ì„¤ì •ê°’ ì‚¬ìš©
4. ì¶œì„/ì§€ê° ì €ì¥ í›„ ì—°ì†ì¶œì„ ì²´í¬:
   - `getStudentAttendanceStreak(studentId)` í˜¸ì¶œ
   - streakì´ `streak_bonus_threshold` ì´ìƒì´ê³  thresholdì˜ ë°°ìˆ˜ì´ë©´ ë³´ë„ˆìŠ¤ ì§€ê¸‰
   - ë³´ë„ˆìŠ¤ ë‹¬ë€íŠ¸: `streak_bonus_points`, type: `'bonus'`, reason: `'ì—°ì† ì¶œì„ NíšŒ ë³´ë„ˆìŠ¤'`

---

#### `GET /api/attendance/history` (ì‹ ê·œ)

**Request:**
```
GET /api/attendance/history?studentId=clxxx&limit=20
```

**Response:**
```json
{
  "history": [
    {
      "date": "2026-02-13",
      "status": "present",
      "memo": null,
      "createdAt": "2026-02-13T10:30:00Z"
    },
    {
      "date": "2026-02-06",
      "status": "late",
      "memo": "ëŠ¦ì ",
      "createdAt": "2026-02-06T10:45:00Z"
    }
  ],
  "streak": 4,
  "totalPresent": 15,
  "totalLate": 3,
  "totalAbsent": 2
}
```

---

#### `GET /api/settings` (ì‹ ê·œ)

**Request:**
```
GET /api/settings
```

**Response:**
```json
{
  "attendance_talent_points": "5",
  "streak_bonus_threshold": "4",
  "streak_bonus_points": "10"
}
```

---

#### `PUT /api/settings` (ì‹ ê·œ)

**Request:**
```json
{
  "attendance_talent_points": "10",
  "streak_bonus_threshold": "4",
  "streak_bonus_points": "15"
}
```

**Response:**
```json
{ "success": true }
```

---

## 5. UI/UX Design

### 5.1 ì¶œì„ í˜ì´ì§€ ë ˆì´ì•„ì›ƒ (ìˆ˜ì • í›„)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header: "ì¶œì„ ê´€ë¦¬"                  â”‚
â”‚  subtitle: "2026ë…„ 2ì›” 13ì¼ ëª©ìš”ì¼"   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Weekly Calendar - ê¸°ì¡´]            â”‚
â”‚  â† ì¼ ì›” í™” ìˆ˜ ëª© ê¸ˆ í†  â†’           â”‚
â”‚     ë¯¸ë˜ ë‚ ì§œëŠ” íšŒìƒ‰+ë¹„í™œì„±í™”(FR-05)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ì¶œì„ í†µê³„ (FR-07)               â”‚â”‚
â”‚  â”‚ ì¶œì„ 20ëª… | ì§€ê° 2ëª… | ê²°ì„ 3ëª…  â”‚â”‚
â”‚  â”‚ ì¶œì„ë¥  88%          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ë°˜ ì„ íƒ â–¼]  20/25ëª…               â”‚
â”‚                                      â”‚
â”‚  [ì „ì²´ ì¶œì„] [ì „ì²´ ê²°ì„]    [ì €ì¥]   â”‚
â”‚  (FR-01 ì¼ê´„ì²˜ë¦¬ ë²„íŠ¼)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ”¥4  ê¹€ë¯¼ì¤€  3í•™ë…„Â·ë‹¤ìœ—ë°˜        â”‚â”‚
â”‚  â”‚ (ì—°ì†ì¶œì„ë°°ì§€)    [âœ“] [ğŸ•] [âœ—]  â”‚â”‚
â”‚  â”‚ â† ì¹´ë“œ í´ë¦­ ì‹œ ì´ë ¥ ëª¨ë‹¬(FR-03) â†’â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ ğŸ”¥2  ì´ì„œì—°  2í•™ë…„Â·ëª¨ì„¸ë°˜        â”‚â”‚
â”‚  â”‚               [âœ“] [ğŸ•] [âœ—]     â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ ...                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 User Flow

```
[ì¶œì„ í˜ì´ì§€ ì§„ì…]
  â”œâ†’ ë‚ ì§œ ì„ íƒ (ë¯¸ë˜ ë‚ ì§œ ë¹„í™œì„±í™”)
  â”œâ†’ ë°˜ í•„í„° ì„ íƒ
  â”œâ†’ í†µê³„ í™•ì¸ (ìƒë‹¨ ìš”ì•½)
  â”œâ†’ ì¼ê´„ ì²˜ë¦¬ ë˜ëŠ” ê°œë³„ ì¶œì„ ì²´í¬
  â”‚   â”œâ†’ "ì „ì²´ ì¶œì„" í´ë¦­ â†’ ëª¨ë“  í•™ìƒ ì¶œì„ ì²˜ë¦¬
  â”‚   â”œâ†’ "ì „ì²´ ê²°ì„" í´ë¦­ â†’ ëª¨ë“  í•™ìƒ ê²°ì„ ì²˜ë¦¬
  â”‚   â””â†’ ê°œë³„ ë²„íŠ¼ í´ë¦­
  â”‚       â””â†’ ì¶œì„â†’ê²°ì„ ë³€ê²½ ì‹œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ (FR-06)
  â”‚           "ë‹¬ë€íŠ¸ {N}ì ì´ ì°¨ê°ë©ë‹ˆë‹¤. ë³€ê²½í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
  â”œâ†’ í•™ìƒ ì¹´ë“œ í´ë¦­ â†’ ì¶œì„ ì´ë ¥ ëª¨ë‹¬ (FR-03)
  â”‚   â””â†’ ìµœê·¼ 20ê±´ ì´ë ¥, ì—°ì†ì¶œì„, í†µê³„
  â”œâ†’ ì €ì¥ í´ë¦­
  â”‚   â””â†’ ì—°ì† ì¶œì„ ë³´ë„ˆìŠ¤ ì•Œë¦¼ (FR-04)
  â”‚       "ğŸ‰ ê¹€ë¯¼ì¤€ ì—°ì† 4íšŒ ì¶œì„! ë³´ë„ˆìŠ¤ 10ë‹¬ë€íŠ¸"
  â””â†’ ë¯¸ì €ì¥ ìƒíƒœì—ì„œ í˜ì´ì§€ ì´ë™ ì‹œ ê²½ê³  (FR-08)
      "ì €ì¥í•˜ì§€ ì•Šì€ ë³€ê²½ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤."
```

### 5.3 Component List

| Component/Section | Location | Responsibility | FR |
|-------------------|----------|----------------|----|
| BulkActionButtons | attendance/page.tsx (ì¸ë¼ì¸) | ì „ì²´ ì¶œì„/ê²°ì„ ë²„íŠ¼ | FR-01 |
| AttendanceSummary | attendance/page.tsx (ì¸ë¼ì¸) | ìƒë‹¨ ì¶œì„ë¥  í†µê³„ ì¹´ë“œ | FR-07 |
| StreakBadge | attendance/page.tsx (ì¸ë¼ì¸) | í•™ìƒ ì¹´ë“œì˜ ì—°ì†ì¶œì„ ë°°ì§€ | FR-04 |
| HistoryModal | attendance/page.tsx (ì¸ë¼ì¸) | í•™ìƒë³„ ì¶œì„ ì´ë ¥ ëª¨ë‹¬ | FR-03 |
| ConfirmDialog | attendance/page.tsx (ì¸ë¼ì¸) | ì¶œì„â†’ê²°ì„ ë³€ê²½ í™•ì¸ | FR-06 |
| StreakBonusToast | attendance/page.tsx (ì¸ë¼ì¸) | ë³´ë„ˆìŠ¤ ë‹¬ë€íŠ¸ ì•Œë¦¼ | FR-04 |
| UnsavedGuard | attendance/page.tsx (useEffect) | beforeunload ì´ë²¤íŠ¸ | FR-08 |
| AttendanceSettingsTab | settings/page.tsx (íƒ­ ì¶”ê°€) | ë‹¬ë€íŠ¸ ì„¤ì • UI | FR-02 |

> ëª¨ë“  UIëŠ” attendance/page.tsxì™€ settings/page.tsx íŒŒì¼ ë‚´ ì¸ë¼ì¸ìœ¼ë¡œ êµ¬í˜„. ë³„ë„ ì»´í¬ë„ŒíŠ¸ íŒŒì¼ ìƒì„±í•˜ì§€ ì•ŠìŒ (ê¸°ì¡´ í”„ë¡œì íŠ¸ íŒ¨í„´ ìœ ì§€).

### 5.4 ì¶œì„ ì´ë ¥ ëª¨ë‹¬ (FR-03)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ê¹€ë¯¼ì¤€ ì¶œì„ ì´ë ¥              [ë‹«ê¸°] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ”¥ ì—°ì† ì¶œì„ 4íšŒ                    â”‚
â”‚  ì¶œì„ 15íšŒ | ì§€ê° 3íšŒ | ê²°ì„ 2íšŒ     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2026-02-13  âœ… ì¶œì„                 â”‚
â”‚  2026-02-06  âœ… ì¶œì„                 â”‚
â”‚  2026-01-30  ğŸ• ì§€ê°  "ëŠ¦ì "         â”‚
â”‚  2026-01-23  âœ… ì¶œì„                 â”‚
â”‚  2026-01-16  âŒ ê²°ì„  "ê°ê¸°"         â”‚
â”‚  ...                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.5 ì„¤ì • í˜ì´ì§€ ë‹¬ë€íŠ¸ íƒ­ (FR-02)

```
ì„¤ì • í˜ì´ì§€ íƒ­:
[êµì‚¬ ê´€ë¦¬] [ë°˜ ê´€ë¦¬] [ë‹¬ë€íŠ¸ ì„¤ì •]  â† ì‹ ê·œ íƒ­ ì¶”ê°€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì¶œì„ ë‹¬ë€íŠ¸ ì„¤ì •                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ì¶œì„ ì§€ê¸‰ ë‹¬ë€íŠ¸       [  5  ] ì    â”‚
â”‚  ì—°ì† ì¶œì„ ë³´ë„ˆìŠ¤ ê¸°ì¤€  [  4  ] íšŒ   â”‚
â”‚  ì—°ì† ì¶œì„ ë³´ë„ˆìŠ¤ ë‹¬ë€íŠ¸ [ 10 ] ì    â”‚
â”‚                                      â”‚
â”‚  â„¹ï¸ ì—°ì† ì¶œì„ ë³´ë„ˆìŠ¤ëŠ” ê¸°ì¤€ íšŸìˆ˜ì˜   â”‚
â”‚     ë°°ìˆ˜ë§ˆë‹¤ ì§€ê¸‰ë©ë‹ˆë‹¤.             â”‚
â”‚     (4íšŒ, 8íšŒ, 12íšŒ...)              â”‚
â”‚                                      â”‚
â”‚                         [ì €ì¥í•˜ê¸°]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Error Handling

### 6.1 Error Responses

| Code | Endpoint | Message | Cause |
|------|----------|---------|-------|
| 400 | POST /api/attendance | "ë¯¸ë˜ ë‚ ì§œì—ëŠ” ì¶œì„ì„ ê¸°ë¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤." | date > today |
| 400 | GET /api/attendance/history | "studentIdê°€ í•„ìš”í•©ë‹ˆë‹¤." | íŒŒë¼ë¯¸í„° ëˆ„ë½ |
| 401 | All endpoints | "Unauthorized" | ë¯¸ì¸ì¦ |
| 403 | PUT /api/settings | "ê´€ë¦¬ìë§Œ ì„¤ì •ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤." | role !== 'admin' |
| 500 | All endpoints | "Internal server error" | ì„œë²„ ì˜¤ë¥˜ |

### 6.2 Client-side Error Handling

| ìƒí™© | ì²˜ë¦¬ |
|------|------|
| ì €ì¥ ì‹¤íŒ¨ | `alert()` ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ, changes ìœ ì§€ |
| ì´ë ¥ ì¡°íšŒ ì‹¤íŒ¨ | ëª¨ë‹¬ì— "ì´ë ¥ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤" í‘œì‹œ |
| ì„¤ì • ì €ì¥ ì‹¤íŒ¨ | `alert()` ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ |
| ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ | `console.error` + ì‚¬ìš©ìì—ê²Œ ì¬ì‹œë„ ì•ˆë‚´ |

---

## 7. Security Considerations

- [x] ë‚ ì§œ ì…ë ¥ ê²€ì¦ (ë¯¸ë˜ ë‚ ì§œ ì°¨ë‹¨)
- [x] ì¸ì¦ í™•ì¸ (ëª¨ë“  APIì—ì„œ getSession())
- [x] ì„¤ì • ë³€ê²½ì€ admin ì—­í• ë§Œ ê°€ëŠ¥ (role ì²´í¬)
- [x] SQL Injection ë°©ì§€ (better-sqlite3 prepared statement ì‚¬ìš©)
- [ ] Rate Limiting (í˜„ì¬ ë¯¸ì ìš© - ë‚´ë¶€ ì‹œìŠ¤í…œì´ë¯€ë¡œ ë¶ˆí•„ìš”)

---

## 8. Test Plan

### 8.1 ìˆ˜ë™ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ (Zero Script QA)

| # | ì‹œë‚˜ë¦¬ì˜¤ | ì˜ˆìƒ ê²°ê³¼ |
|---|----------|----------|
| 1 | "ì „ì²´ ì¶œì„" í´ë¦­ â†’ ì €ì¥ | ëª¨ë“  í•™ìƒ ì¶œì„, ê°ê° ë‹¬ë€íŠ¸ ì§€ê¸‰ |
| 2 | "ì „ì²´ ê²°ì„" í´ë¦­ â†’ ì €ì¥ | ëª¨ë“  í•™ìƒ ê²°ì„, ê¸°ì¡´ ì¶œì„ì ë‹¬ë€íŠ¸ ì°¨ê° |
| 3 | ê°œë³„ ì¶œì„â†’ê²°ì„ ë³€ê²½ | í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ, í™•ì¸ ì‹œ ë³€ê²½ |
| 4 | ë¯¸ë˜ ë‚ ì§œ ì„ íƒ | ìº˜ë¦°ë”ì—ì„œ ë¹„í™œì„±í™”, API 400 ì—ëŸ¬ |
| 5 | í•™ìƒ ì¹´ë“œ í´ë¦­ | ì¶œì„ ì´ë ¥ ëª¨ë‹¬ í‘œì‹œ |
| 6 | 4íšŒ ì—°ì† ì¶œì„ í•™ìƒ ì €ì¥ | ë³´ë„ˆìŠ¤ ë‹¬ë€íŠ¸ ì•Œë¦¼ í‘œì‹œ |
| 7 | ì„¤ì •ì—ì„œ ë‹¬ë€íŠ¸ ê°’ ë³€ê²½ â†’ ì¶œì„ ì €ì¥ | ë³€ê²½ëœ ê°’ìœ¼ë¡œ ë‹¬ë€íŠ¸ ì§€ê¸‰ |
| 8 | ë³€ê²½ í›„ í˜ì´ì§€ ì´ë™ | beforeunload ê²½ê³  í‘œì‹œ |

---

## 9. Implementation Guide

### 9.1 íŒŒì¼ ë³€ê²½ ëª©ë¡

```
ë³€ê²½ë˜ëŠ” íŒŒì¼:
â”œâ”€â”€ src/lib/db.ts                              (ìˆ˜ì •: 5ê°œ í•¨ìˆ˜ ì¶”ê°€)
â”œâ”€â”€ src/app/api/attendance/route.ts            (ìˆ˜ì •: ë‚ ì§œ ê²€ì¦, ì„¤ì •ê°’ ì°¸ì¡°, ìŠ¤íŠ¸ë¦­ ë³´ë„ˆìŠ¤)
â”œâ”€â”€ src/app/(dashboard)/attendance/page.tsx     (ìˆ˜ì •: 7ê°œ UI ê¸°ëŠ¥ ì¶”ê°€)
â”œâ”€â”€ src/app/(dashboard)/settings/page.tsx       (ìˆ˜ì •: ë‹¬ë€íŠ¸ ì„¤ì • íƒ­ ì¶”ê°€)

ìƒˆë¡œ ìƒì„±ë˜ëŠ” íŒŒì¼:
â”œâ”€â”€ src/app/api/attendance/history/route.ts     (ì‹ ê·œ: í•™ìƒë³„ ì´ë ¥ API)
â””â”€â”€ src/app/api/settings/route.ts              (ì‹ ê·œ: ì„¤ì • CRUD API)
```

### 9.2 Implementation Order

#### Step 1: DB í•¨ìˆ˜ ì¶”ê°€ (`src/lib/db.ts`)

```typescript
// 1-1. Setting CRUD
export function getSettingValue(key: string, defaultValue: string): string {
  // SELECT value FROM Setting WHERE key = ?
  // ì—†ìœ¼ë©´ defaultValue ë°˜í™˜
}

export function upsertSetting(key: string, value: string): void {
  // SELECT â†’ ìˆìœ¼ë©´ UPDATE, ì—†ìœ¼ë©´ INSERT
}

// 1-2. ì¶œì„ ì´ë ¥ ì¡°íšŒ
export function getStudentAttendanceHistory(
  studentId: string, limit: number = 20
): { date: string; status: string; memo: string | null; createdAt: string }[] {
  // SELECT date, status, memo, createdAt FROM Attendance
  // WHERE studentId = ? ORDER BY date DESC LIMIT ?
}

// 1-3. ì—°ì† ì¶œì„ ê³„ì‚°
export function getStudentAttendanceStreak(studentId: string): number {
  // SELECT date, status FROM Attendance
  // WHERE studentId = ? AND status IN ('present', 'late')
  // ORDER BY date DESC
  // â†’ ìµœê·¼ ë‚ ì§œë¶€í„° ì—°ì†ìœ¼ë¡œ present/lateì¸ íšŸìˆ˜ ê³„ì‚°
  // â†’ ì¤‘ê°„ì— absentê°€ ìˆê±°ë‚˜ ê¸°ë¡ì´ ì—†ìœ¼ë©´ ì¤‘ë‹¨
}

// 1-4. ë‚ ì§œë³„ ì¶œì„ ìš”ì•½
export function getAttendanceSummaryByDate(
  date: string, classId?: string
): { total: number; present: number; late: number; absent: number } {
  // COUNT ì¿¼ë¦¬ë¡œ ê° statusë³„ ì§‘ê³„
}
```

#### Step 2: ì„¤ì • API (`src/app/api/settings/route.ts`)

```typescript
// GET: ì „ì²´ ì„¤ì • ì¡°íšŒ (ì¸ì¦ í•„ìš”)
// PUT: ì„¤ì • ì €ì¥ (adminë§Œ)
```

#### Step 3: ì¶œì„ ì´ë ¥ API (`src/app/api/attendance/history/route.ts`)

```typescript
// GET ?studentId={id}&limit=20
// â†’ getStudentAttendanceHistory() + getStudentAttendanceStreak()
// â†’ í†µê³„ (present/late/absent ê° count)
```

#### Step 4: ì¶œì„ API ìˆ˜ì • (`src/app/api/attendance/route.ts`)

```typescript
// GET ìˆ˜ì •: ê° í•™ìƒë³„ streak í¬í•¨ + summary ì¶”ê°€
// POST ìˆ˜ì •:
//   1. ë‚ ì§œ ê²€ì¦ (FR-05)
//   2. getSettingValue('attendance_talent_points', '5') (FR-02)
//   3. ê¸°ì¡´ ë‹¬ë€íŠ¸ ë¡œì§ì˜ ATTENDANCE_TALENT â†’ ì„¤ì •ê°’
//   4. ì €ì¥ í›„ streak ì²´í¬ â†’ ë³´ë„ˆìŠ¤ ì§€ê¸‰ (FR-04)
```

#### Step 5: ì„¤ì • í˜ì´ì§€ ìˆ˜ì • (`src/app/(dashboard)/settings/page.tsx`)

```typescript
// 1. 'talent' íƒ­ ì¶”ê°€ (ê¸°ì¡´ 'users', 'classes' + 'talent')
// 2. ë‹¬ë€íŠ¸ ì„¤ì • í¼ (3ê°œ ì…ë ¥ í•„ë“œ)
// 3. ì €ì¥ â†’ PUT /api/settings
```

#### Step 6: ì¶œì„ í˜ì´ì§€ ìˆ˜ì • (`src/app/(dashboard)/attendance/page.tsx`)

```typescript
// 6-1. ë¯¸ë˜ ë‚ ì§œ ë¹„í™œì„±í™” (FR-05)
//   - ìº˜ë¦°ë”ì—ì„œ isFuture(day) ê²€ì‚¬ â†’ disabled ìŠ¤íƒ€ì¼

// 6-2. ì¶œì„ í†µê³„ ìš”ì•½ (FR-07)
//   - API ì‘ë‹µì˜ summary ë°ì´í„°ë¡œ í†µê³„ ì¹´ë“œ í‘œì‹œ

// 6-3. ì¼ê´„ ì²˜ë¦¬ ë²„íŠ¼ (FR-01)
//   - "ì „ì²´ ì¶œì„" â†’ ëª¨ë“  í•™ìƒì˜ attendanceChangesë¥¼ presentë¡œ ì„¤ì •
//   - "ì „ì²´ ê²°ì„" â†’ ëª¨ë“  í•™ìƒì˜ attendanceChangesë¥¼ absentë¡œ ì„¤ì •

// 6-4. ë¯¸ì €ì¥ ë³€ê²½ ê²½ê³  (FR-08)
//   - useEffectë¡œ beforeunload ì´ë²¤íŠ¸ ë“±ë¡
//   - attendanceChangesê°€ ë¹„ì–´ìˆì§€ ì•Šì„ ë•Œë§Œ í™œì„±í™”

// 6-5. ìƒíƒœ ë³€ê²½ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ (FR-06)
//   - handleStatusChangeì—ì„œ ì¶œì„/ì§€ê° â†’ ê²°ì„ ë³€ê²½ ê°ì§€
//   - í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ í‘œì‹œ í›„ ë³€ê²½

// 6-6. ì—°ì† ì¶œì„ ë°°ì§€ (FR-04)
//   - student.streak > 0ì´ë©´ ğŸ”¥{streak} ë°°ì§€ í‘œì‹œ

// 6-7. ì¶œì„ ì´ë ¥ ëª¨ë‹¬ (FR-03)
//   - í•™ìƒ ì´ë¦„/í•™ë…„ ì˜ì—­ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
//   - GET /api/attendance/history?studentId={id} í˜¸ì¶œ
//   - AnimatePresence ëª¨ë‹¬ë¡œ ì´ë ¥ í‘œì‹œ
```

### 9.3 êµ¬í˜„ ìˆœì„œ ìš”ì•½

| ìˆœì„œ | ì‘ì—… | íŒŒì¼ | FR |
|-----|------|------|----|
| 1 | DB í•¨ìˆ˜ ì¶”ê°€ | db.ts | FR-02,03,04,07 |
| 2 | ì„¤ì • API | api/settings/route.ts | FR-02 |
| 3 | ì´ë ¥ API | api/attendance/history/route.ts | FR-03 |
| 4 | ì¶œì„ API ìˆ˜ì • | api/attendance/route.ts | FR-02,04,05 |
| 5 | ì„¤ì • í˜ì´ì§€ íƒ­ ì¶”ê°€ | settings/page.tsx | FR-02 |
| 6 | ì¶œì„ í˜ì´ì§€ UI | attendance/page.tsx | FR-01,03,04,05,06,07,08 |

---

## 10. Coding Convention Reference

### 10.1 ê¸°ì¡´ í”„ë¡œì íŠ¸ ê·œì¹™ (CLAUDE.md ê¸°ë°˜)

| Target | Rule | Example |
|--------|------|---------|
| DB í•¨ìˆ˜ | camelCase, get/create/update/delete/upsert ì ‘ë‘ì‚¬ | `getSettingValue()` |
| API Route | `route.ts` íŒŒì¼ ë‚´ `GET`, `POST`, `PUT` export | `export async function GET()` |
| ì»´í¬ë„ŒíŠ¸ | 'use client' í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ | `export default function Page()` |
| ID ìƒì„± | `{prefix}-${Date.now()}-${random}` | `setting-${Date.now()}-xxx` |
| ì—ëŸ¬ ì‘ë‹µ | `{ error: string }` í˜•ì‹ | `{ error: 'Unauthorized' }` |
| ë‚ ì§œ í¬ë§· | `yyyy-MM-dd` (API íŒŒë¼ë¯¸í„°) | `2026-02-13` |

### 10.2 Import Order (ê¸°ì¡´ íŒ¨í„´ ìœ ì§€)

```typescript
// 1. React/Next.js
import { NextRequest, NextResponse } from 'next/server';
// 2. Internal libs
import { getSession } from '@/lib/auth';
import { functionName } from '@/lib/db';
```

---

## Version History

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 0.1 | 2026-02-13 | Initial draft | Claude Code |
